### Paxos算法

- Paxos算法的一种基于消息传递且具有高度容错性的一致性算法。
- Paxos算法需要解决的问题就是如何在可能发生诸如机器宕机或网络故障的分布式系统中，快速且正确地在集群内部对某个数据的值达成一致，并且保证不论发生以上任何异常，都不会破坏整个系统的一致性

- Paxos 算法解决`来自客户端的值被发送到集群中的任意一点，而后集群中的所有节点为该值达成共识的一种协调算法`

#### 前提

- 每个参与者以任意的速度执行，且都可能因为未知原因崩溃。
- 当一个提案被选定后，所有参与者都可能失败或者崩溃
- 消息在网络传递的过程中可能延迟或丢失，但不会被篡改





#### 实现过程

- Paxos算法中有三个角色：Proposer、Acceptor和Learner
  1. Proposer负责发起提案（提案可以是任何值或者操作）
  2. Acceptor负责对Proposer发起的提案进行选定
  3. Learner不对提案选举过程作干扰，用于对提案的选定起作用，并且每个Learner都应该知道所有被通过的提案



##### 阶段一

1. Proposer1选择提案编号为Mn，将向超过半数的Acceptor发送该编号的prepare请求

2. 一个Acceptor接收到Mn提案时，如果它当时未同意任何提案，就会接收该提案；如果它已响应过比Mn编号小的提案Mn-1，那么它会接收Mn提案，并将Mn-1返回给Proposer1，并通知Mn-1提案的发起者

##### 阶段二

1. 如果Proposer1接收到半数以上的Acceptor对于提案Mn的响应，那么它会发送一个针对【Mn，Vn】的Accept请求给Acceptor，Vn的值为收到的响应中编号最大的提案的值，如果响应中不包含任何提案，那么它就是任意值
2. 如果Acceptor收到这个针对【Mn，Vn】提案的Acceptor请求，只要该Acceptor尚未接收过任何比Mn编号大的提案，那么它就可以通过这个提案



##### 提案的获取

- 以上阶段一、二仅仅体现了提案的选举过程，但是提案的选定需要Learner对提案的通过票数进行统计，当某个提案被一半以上的Acceptor接收时，该提案被通过
- Learner获取提案结果有以下三种方式：
  1. 每个Acceptor在接受一个提案时，向所有Learner发送信息，这个方式消耗太大，不推荐
  2. 选举主Learner，所有Acceptor接受提案时，发送消息给这个Learner，在统计到过半的提案时，同步给其它Learner。存在单点问题
  3. 主Learner集群，每个Acceptor接受提案后向主Learner集群的每个Learner发送消息，再同步给其它Learner