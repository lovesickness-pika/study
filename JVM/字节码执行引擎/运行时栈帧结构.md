### 运行时栈帧

##### 什么是栈帧

- Java虚拟机以方法作为最基本的执行单元，“栈帧”是用于支持虚拟机进行方法调用和方法执行的数据结构

##### 栈帧存储了什么

- 栈帧存储了方法局部变量表、操作数栈、动态连接、方法返回地址等信息

##### 栈帧的大小

- 栈帧需要多大的局部变量表，需要多深的操作数栈在编译器就已经确定了，并写入到了方法表的Code属性中；也就是说，一个方法需要的内存大小在编译期已经被确定，其取决于程序源码和具体在虚拟机内实现的栈内存布局形式

##### 





#### 局部变量表

- 局部变量表是一组变量值的存储空间，用于存放方法参数和方法内部定义的局部变量
- 局部变量表以变量槽作为基本单位，一个变量槽的大小为32位
- 变量槽可复用



#### 操作数栈

- 后入先出（Last In First Out LILF）栈
- 操作数栈的最大深度在编译器已经确定
- 操作数栈的元素数据类型与字节码指令的序列严格匹配，编译期和类加载的数据流验证期都会验证这一点



#### 动态连接

- 每个栈帧有一个指向运行时常量池中该栈帧所属方法的引用，持有这个引用是为了支持方法调用过程中的动态连接。Class文件的常量池有大量的符号引用，字节码中的方法的调用指令就以常量池里指向的方法的符号引用作为参数。这些符号引用一部分会在类加载阶段或者第一次使用时就被转为直接引用，这部分就叫做静态解析。另一部分在每次运行期间转化为直接引用，叫做动态连接



#### 方法返回地址



- 正常调用返回：执行引擎遇到任何一个方法返回的字节码指令

- 异常调用返回：方法抛出异常
- 方法返回到最初方法被调用的位置，使上层方法继续执行