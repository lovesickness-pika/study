### 分派



##### 静态类型与实际类型

```java
Map map = new HashMap();
```

- 上述代码中，Map为变量map的静态类型，HashMap为map的实际类型



#### 静态分派

- 所有依赖静态类型来决定方法执行版本的分派动作叫做静态分派
- 静态分派发生在编译阶段
- 确定静态分派的动作不是由虚拟机完成的
- 一个char类型的自动转换过程：char->int->long->float->double

- 变长参数的重载优先级是最低的



#### 动态分派

- 在运行期根据实际类型决定方法执行版本的分派过程叫做动态 分派
- 动态分派发生在运行期间
- 动态分派的动作由方法调用指令invokevirtual完成



##### invokevirtual进行动态分配

1. 找到操作数栈顶的第一个元素所指向的实际类型
2. 如果在它的实际类型中找到与常量中的描述符合简单名称都相符的方法，则进行访问权限校验，如果通过则返回这个方法的直接引用，不通过则抛出IllegalAccessError
3. 如果它的实际类型中没找到匹配的方法，则对它的父类重复这个过程





#### 虚拟机动态分派的表现

- 虚拟机使用虚方法表和接口方法表对动态分派进行优化
- 类型继承关系分析、守护关联、内联缓存